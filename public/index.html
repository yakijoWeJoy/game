<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a Snowman for a Friend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }

        .input-container {
            margin: 20px;
        }

        input[type="text"], input[type="submit"] {
            padding: 10px;
            font-size: 16px;
        }

        #link-container {
            margin-top: 20px;
        }
    </style>
   
</head>
<body>

    <h1>Create a Snowman for a Friend</h1>
    <div class="input-container">
      
        <input type="text" id="word-input"   pattern="[A-Za-z\s]+"  placeholder="Enter a word/s :"><br><br>

     
        <input type="submit" value="Create Link" onclick="createLink()">
    </div>
    <div id="word-display" class="word-display"></div>
   
    <div id="link-container"></div>
    <br>
    <div id="try_it_yourself" ></div>
    <div><img src="img/snowman.jpeg" alt="A cute snowman" width="300" height="300"></div>

</body>
<script>
    let playerID = '';
      window.onload = () => {
            //get id from querystring 
            const urlParams = new URLSearchParams(window.location.search);
            playerID = localStorage.getItem("playerID");
            if(!playerID){
                playerID = generteId()
                localStorage.setItem("playerID",playerID) 
            }
           
            


        }
    // Simple encryption using Base64 encoding (you can replace with stronger encryption)
    function generteId() {
            return Math.random().toString(36).substring(2, 15);

        }
    function encrypt(text) {
        return btoa(text);
    }

    function createLink() {
        const word = document.getElementById("word-input").value;
        if (word === '') {
            alert('Please enter a word.');
            return;
        }
        var gameid = generteId();
   
        document.getElementById('word-display').innerHTML = convertToPattern(word).replace(/ /g, '&nbsp;');;
        const encryptedWord = encrypt(word);
        const link = `${window.location.origin}/snowman.html?word=${encryptedWord}&p=${playerID}&g=${gameid}`;
        const whatsapLink= generateWhatsAppLink(link);

        document.getElementById('link-container').innerHTML = `<a href="${whatsapLink}" target="_blank">Send this link to your friend with WhatsApp</a>`;
        document.getElementById('try_it_yourself').innerHTML = `<a href="${link}" target="_blank">try it yourself</a>`;

    }

    function generateWhatsAppLink(baseUrl) {

            const message = 'guess my snowman';
            const encodedMessage = encodeURIComponent(`${message} ${baseUrl}`);
            const shareUrl = `https://api.whatsapp.com/send?text=${encodedMessage}`;
            return  shareUrl;

    }

    function convertToPattern(input) {
        // Trim leading/trailing spaces and replace single spaces between words with double spaces
        const trimmedInput = input.trim();
    
    // Replace letters with underscores and keep spaces as separators
    const pattern = trimmedInput.split(' ').map(word => {
        // Replace each letter in the word with an underscore and join with a single space
        return word.split('').map(() => '_').join(' ');
    }).join('    '); // Join words with double spaces

    return pattern;
   }

    document.getElementById('word-input').addEventListener('input', function (e) {
        this.value = this.value.replace(/[^A-Za-z\s]/g, '');
    });
</script>
</html>
